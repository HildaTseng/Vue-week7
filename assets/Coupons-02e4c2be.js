import{p as v,M as C}from"./modal-70f73a6a.js";import{_ as k,r as M,o as l,c as d,a as t,F as x,g as w,d as D,w as u,v as p,i as V,f as g,t as c}from"./index-53a7fb00.js";const{VITE_URL:r,VITE_PATH:m}={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"hilda88",BASE_URL:"/Vue-week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let h="",_="";const E={data(){return{coupons:[],pages:{},tempCoupon:{code:"",is_enabled:1,percent:100,title:""},currentPage:1,isNew:!1,due_date:""}},methods:{getCoupons(s=1){this.currentPage=s,this.$http.get(`${r}/api/${m}/admin/coupons/?page=${s}`).then(e=>{this.coupons=e.data.coupons,this.pages=e.data.pagination}).catch(e=>{alert(e.response.data.message)})},turnDate(s){const e=new Date(s*1e3),i=e.getFullYear(),b=(e.getMonth()+1).toString().padStart(2,"0"),n=e.getDate().toString().padStart(2,"0");return`${i}-${b}-${n}`},dueDate(s){this.tempCoupon.due_date=Math.floor(new Date(s).getTime()/1e3)},openModal(s,e){s==="new"?(this.tempCoupon={},this.isNew=!0,h.show()):s==="edit"?(this.tempCoupon={...e},this.tempCoupon.due_date=this.turnDate(e.due_date),this.isNew=!1,h.show()):s==="delete"&&(this.tempCoupon={...e},_.show())},updateCoupon(){let s=`${r}/api/${m}/admin/coupon`,e="post";this.isNew||(s=`${r}/api/${m}/admin/coupon/${this.tempCoupon.id}`,e="put"),this.tempCoupon.due_date&&this.dueDate(this.tempCoupon.due_date),this.$http[e](s,{data:this.tempCoupon}).then(i=>{alert(i.data.message),h.hide(),this.getCoupons()}).catch(i=>{alert(i.data.message)}),this.tempCoupon.due_date&&this.turnDate(this.tempCoupon.due_date)},delCoupon(){this.$http.delete(`${r}/api/${m}/admin/coupon/${this.tempCoupon.id}`).then(s=>{alert(s.data.message),_.hide(),this.getCoupons(this.currentPage)}).catch(s=>{alert(s.response.data.message)})}},components:{pagination:v},mounted(){h=new C(document.getElementById("couponModal")),_=new C(document.getElementById("delCouponModal")),this.getCoupons()}},T={class:"container"},L={class:"text-end mt-4"},P={class:"table w-100 mt-4"},S=t("thead",null,[t("tr",{class:"fs-5"},[t("th",null,"名稱"),t("th",null,"折扣百分比"),t("th",null,"到期日"),t("th",null,"是否啟用"),t("th",null,"編輯")])],-1),U={key:0,class:"text-success"},B={key:1},I={class:"btn-group"},N=["onClick"],R=["onClick"],A={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},F={class:"modal-dialog modal-dialog-centered"},H={class:"modal-content"},O={class:"modal-header bg-success text-dark bg-opacity-25"},Y={class:"modal-title fs-4",id:"exampleModalLabel"},$={key:0},j={key:1},q=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),z={class:"modal-body"},G={class:"mb-3"},J=t("label",{for:"title",class:"form-label"},"優惠券名稱",-1),K={class:"mb-3"},Q=t("label",{for:"coupon-code",class:"form-label"},"優惠券代碼",-1),W={class:"mb-3"},X=t("label",{for:"discount",class:"form-label"},"折扣百分比",-1),Z={class:"mb-3"},tt=t("label",{for:"due_date",class:"form-label"},"到期日",-1),et={class:"form-check"},ot=t("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),st={class:"modal-footer"},nt=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1),at={class:"modal fade",id:"delCouponModal",tabindex:"-1","aria-labelledby":"delCouponModalLabel","aria-hidden":"true"},lt={class:"modal-dialog modal-dialog-centered"},dt={class:"modal-content"},it=t("div",{class:"modal-header bg-danger"},[t("h2",{class:"modal-title fs-4 text-white",id:"exampleModalLabel"},"刪除優惠券"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ut={class:"modal-body"},pt={class:"text-danger"},ct={class:"modal-footer"},rt=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function mt(s,e,i,b,n,a){const f=M("pagination");return l(),d("div",T,[t("div",L,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=o=>a.openModal("new"))}," 建立新優惠券 ")]),t("table",P,[S,t("tbody",null,[(l(!0),d(x,null,w(n.coupons,o=>(l(),d("tr",{key:o.id},[t("td",null,c(o.title),1),t("td",null,c(o.percent)+" %",1),t("td",null,c(a.turnDate(o.due_date)),1),t("td",null,[o.is_enabled?(l(),d("span",U,"已啟用")):(l(),d("span",B,"未啟用"))]),t("td",null,[t("div",I,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:y=>a.openModal("edit",o)},"檢視",8,N),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:y=>a.openModal("delete",o)},"刪除",8,R)])])]))),128))])]),D(f,{pages:n.pages,onEmitPages:a.getCoupons},null,8,["pages","onEmitPages"]),t("div",A,[t("div",F,[t("div",H,[t("div",O,[t("h2",Y,[n.isNew?(l(),d("span",$,"新增優惠卷")):(l(),d("span",j,"編輯優惠卷"))]),q]),t("div",z,[t("div",G,[J,u(t("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入優惠券名稱","onUpdate:modelValue":e[1]||(e[1]=o=>n.tempCoupon.title=o)},null,512),[[p,n.tempCoupon.title]])]),t("div",K,[Q,u(t("input",{type:"text",class:"form-control",id:"coupon-code",placeholder:"請輸入優惠券代碼","onUpdate:modelValue":e[2]||(e[2]=o=>n.tempCoupon.code=o)},null,512),[[p,n.tempCoupon.code]])]),t("div",W,[X,u(t("input",{type:"number",class:"form-control",id:"discount",placeholder:"請輸入折扣百分比","onUpdate:modelValue":e[3]||(e[3]=o=>n.tempCoupon.percent=o)},null,512),[[p,n.tempCoupon.percent]])]),t("div",Z,[tt,u(t("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":e[4]||(e[4]=o=>n.tempCoupon.due_date=o)},null,512),[[p,n.tempCoupon.due_date]])]),t("div",et,[u(t("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[5]||(e[5]=o=>n.tempCoupon.is_enabled=o),id:"is_enabled"},null,512),[[V,n.tempCoupon.is_enabled]]),ot])]),t("div",st,[nt,t("button",{type:"button",class:"btn btn-primary",onClick:e[6]||(e[6]=(...o)=>a.updateCoupon&&a.updateCoupon(...o))},"確認")])])])]),t("div",at,[t("div",lt,[t("div",dt,[it,t("div",ut,[g(" 是否刪除"),t("strong",pt,c(n.tempCoupon.title),1),g(" 優惠券(刪除後將無法恢復)。 ")]),t("div",ct,[rt,t("button",{type:"button",class:"btn btn-primary",onClick:e[7]||(e[7]=(...o)=>a.delCoupon&&a.delCoupon(...o))},"確認刪除")])])])])])}const bt=k(E,[["render",mt]]);export{bt as default};
