import{p as C,M as g}from"./modal-70f73a6a.js";import{_ as M,r as D,o as n,c as a,a as t,F as _,g as u,d as E,t as l,h as f,w as O,i as k,f as v}from"./index-53a7fb00.js";const{VITE_URL:h,VITE_PATH:p}={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"hilda88",BASE_URL:"/Vue-week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let m="",b="";const V={data(){return{orders:[],pages:{},tempOrder:{},currentPage:1}},methods:{getOrders(d=1){this.currentPage=d,this.$http.get(`${h}/api/${p}/admin/orders/?page=${d}`).then(o=>{this.orders=o.data.orders,this.pages=o.data.pagination}).catch(o=>{alert(o.response.data.message)})},turnDate(d){const o=new Date(d*1e3),c=o.getFullYear(),y=o.getMonth()+1,s=o.getDate();return`${c}/${y}/${s}`},toCurrency(d){return(d||0).toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,")},openOrderModal(d){this.tempOrder={...d},m.show()},openDelModal(d){this.tempOrder={...d},b.show()},updateOrder(d){const o={is_paid:d.is_paid};this.$http.put(`${h}/api/${p}/admin/order/${d.id}`,{data:o}).then(c=>{alert(c.data.message),m.hide(),this.getOrders(this.currentPage)}).catch(c=>{alert(c.response.data.message)})},delOrder(){this.$http.delete(`${h}/api/${p}/admin/order/${this.tempOrder.id}`).then(d=>{alert(d.data.message),b.hide(),this.getOrders(this.currentPage)}).catch(d=>{alert(d.response.data.message)})}},components:{pagination:C},mounted(){m=new g(document.getElementById("orderModal")),b=new g(document.getElementById("delOrderModal")),this.getOrders()}},P={class:"container my-5"},L={class:"table"},S=t("thead",null,[t("tr",{class:"fs-5"},[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),T={style:{width:"150px"}},B={style:{width:"250px"}},I={class:"list-unstyled"},U={style:{width:"150px"}},R={style:{width:"150px"}},N={class:"form-check form-switch"},A=["id","onUpdate:modelValue"],F=["for"],q={key:0},H={key:1},j={style:{width:"150px"}},Y={class:"btn-group"},z=["onClick"],G=["onClick"],J={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},K={class:"modal-dialog modal-dialog-centered modal-xl"},Q={class:"modal-content"},W=t("div",{class:"modal-header bg-success text-dark bg-opacity-25"},[t("h2",{class:"modal-title fs-4",id:"exampleModalLabel"},"訂單內容"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),X={class:"modal-body"},Z={class:"row"},$={class:"col-4"},tt=t("h3",{class:"fs-4 fw-bold mb-4"},"買家資料",-1),et={class:"table"},st={key:0},lt=t("th",null,"姓名",-1),dt=t("th",null,"Email",-1),ot=t("th",null,"電話",-1),nt=t("th",null,"地址",-1),at={class:"col-4"},rt=t("h3",{class:"fs-4 fw-bold mb-4"},"訂單細節",-1),it={class:"table"},ct=t("th",null,"訂單編號",-1),_t=t("th",null,"下單時間",-1),ut=t("th",null,"付款時間",-1),ht={key:0},pt={key:1},mt=t("th",null,"付款狀態",-1),bt={key:0,class:"text-success"},yt={key:1},gt=t("th",null,"總金額",-1),ft={class:"form-check d-flex justify-content-end"},Ot={class:"form-check-label ms-2",for:"flexCheckDefault"},kt={key:0,class:"text-success"},vt={key:1},xt={class:"col-4"},wt=t("h3",{class:"fs-4 fw-bold mb-4"},"選購商品",-1),Ct={class:"table"},Mt=t("thead",null,[t("tr",null,[t("th",null,"商品"),t("th",null,"數量"),t("th",null,"金額")])],-1),Dt={class:"modal-footer"},Et=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1),Vt={class:"modal fade",id:"delOrderModal",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},Pt={class:"modal-dialog modal-dialog-centered"},Lt={class:"modal-content"},St=t("div",{class:"modal-header bg-danger"},[t("h2",{class:"modal-title fs-4 text-white",id:"exampleModalLabel"},"刪除訂單"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Tt={key:0,class:"modal-body"},Bt={class:"text-danger"},It={class:"modal-footer"},Ut=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function Rt(d,o,c,y,s,r){const x=D("pagination");return n(),a("div",P,[t("table",L,[S,t("tbody",null,[(n(!0),a(_,null,u(s.orders,e=>(n(),a("tr",{key:e.id},[t("td",T,l(r.turnDate(e.create_at)),1),t("td",null,l(e.user.email),1),t("td",B,[t("ul",I,[(n(!0),a(_,null,u(e.products,(i,w)=>(n(),a("li",{key:w},l(i.product.title)+" 數量："+l(i.qty)+" "+l(i.product.unit),1))),128))])]),t("td",U,l(r.toCurrency(e.total)),1),t("td",R,[t("div",N,[O(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitchCheck${e.id}`,"onUpdate:modelValue":i=>e.is_paid=i},null,8,A),[[k,e.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitchCheck${e.id}`},[e.is_paid?(n(),a("span",q,"已付款")):(n(),a("span",H,"未付款"))],8,F)])]),t("td",j,[t("div",Y,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:i=>r.openOrderModal(e)},"檢視",8,z),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:i=>r.openDelModal(e)},"刪除",8,G)])])]))),128))])]),E(x,{pages:s.pages,onEmitPages:r.getOrders},null,8,["pages","onEmitPages"]),t("div",J,[t("div",K,[t("div",Q,[W,t("div",X,[t("div",Z,[t("div",$,[tt,t("table",et,[s.tempOrder.user?(n(),a("tbody",st,[t("tr",null,[lt,t("td",null,l(s.tempOrder.user.name),1)]),t("tr",null,[dt,t("td",null,l(s.tempOrder.user.email),1)]),t("tr",null,[ot,t("td",null,l(s.tempOrder.user.tel),1)]),t("tr",null,[nt,t("td",null,l(s.tempOrder.user.address),1)])])):f("",!0)])]),t("div",at,[rt,t("table",it,[t("tbody",null,[t("tr",null,[ct,t("td",null,l(s.tempOrder.id),1)]),t("tr",null,[_t,t("td",null,l(r.turnDate(s.tempOrder.create_at)),1)]),t("tr",null,[ut,t("td",null,[s.tempOrder.paid_date?(n(),a("span",ht,l(r.turnDate(s.tempOrder.paid_date)),1)):(n(),a("span",pt,"時間不正確"))])]),t("tr",null,[mt,t("td",null,[s.tempOrder.is_paid?(n(),a("strong",bt,"已付款")):(n(),a("span",yt,"未付款"))])]),t("tr",null,[gt,t("td",null,l(r.toCurrency(s.tempOrder.total)),1)])])]),t("div",ft,[O(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":o[0]||(o[0]=e=>s.tempOrder.is_paid=e)},null,512),[[k,s.tempOrder.is_paid]]),t("label",Ot,[s.tempOrder.is_paid?(n(),a("span",kt,"已付款")):(n(),a("span",vt,"未付款"))])])]),t("div",xt,[wt,t("table",Ct,[Mt,t("tbody",null,[(n(!0),a(_,null,u(s.tempOrder.products,(e,i)=>(n(),a("tr",{key:e.id},[t("td",null,l(e.product.title),1),t("td",null,l(e.qty)+" / "+l(e.product.unit),1),t("td",null,l(r.toCurrency(e.total)),1)]))),128))])])])])]),t("div",Dt,[Et,t("button",{type:"button",class:"btn btn-primary",onClick:o[1]||(o[1]=e=>r.updateOrder(s.tempOrder))},"修改付款狀態")])])])]),t("div",Vt,[t("div",Pt,[t("div",Lt,[St,s.tempOrder.user?(n(),a("div",Tt,[v(" 是否刪除"),t("strong",Bt,l(s.tempOrder.user.name),1),v(" 訂單(刪除後將無法恢復)。 ")])):f("",!0),t("div",It,[Ut,t("button",{type:"button",class:"btn btn-primary",onClick:o[2]||(o[2]=(...e)=>r.delOrder&&r.delOrder(...e))},"確認刪除")])])])])])}const Ft=M(V,[["render",Rt]]);export{Ft as default};
